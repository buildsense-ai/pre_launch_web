Demo 交互规范

本文档定义了 V0.2 阶段“序列化生成”工作流的完整用户交互体验，旨在为前端 Demo 和开发团队提供清晰的规范。

阶段 1: 触发 (Main Agent)

用户输入 “长文生成” Query。

$$交互规范 1.1$$

 Main Agent 思考 (流式):

前端展示: (已实现) 在对话区正常流式输出 主 Agent 的 Thought。

阶段 2: Main Agent 模板推荐

主 Agent 识别意图，决定调用"长文生成 Pipeline"。

$$交互规范 2.1$$

 Main Agent 思考 (流式):

前端展示: Main Agent 在对话区流式输出思考内容，包括检索知识库中的模板、计算匹配度。

$$交互规范 2.2$$

 模板推荐 (一次性):

前端展示: Main Agent 输出 Top 3 模板推荐卡片，让用户选择或 [不使用模板]。

用户点击"使用此模板"后，作为用户输入显示在对话区。

阶段 3: 状态切换 & 计划生成 (Plan Agent)

用户选择模板后，触发状态切换。

$$交互规范 3.1 (关键)$$

 Agent 状态切换:

触发时机: 用户选择模板后（这是一个用户输入行为）

前端展示: 
- 在对话区显示用户选择消息："选择模板：XXX"
- 主对话框的 UI 必须发生变化，明确告知用户"状态已切换"
- 在输入框附近出现 [Plan Agent X] 标签（类似 Gemini 的 [Canvas X] 标签）
- 对话框边框改变颜色（紫色渐变）
- 对话区插入切换提示："🔄 状态切换：Main Agent → Plan Agent"

$$交互规范 3.2$$

 Plan Agent 思考 (流式):

前端展示: Plan Agent 接手任务，基于用户选择的模板，在对话区流式输出思考内容：
- 分析模板结构
- 检索知识库内容
- 制定生成顺序（非线性）
- 优化章节排列

$$交互规范 3.3$$

 "序列计划" UI 模块 (一次性, 核心):

Plan Agent 完成后，一个独立的 UI 模块出现（右侧面板），展示完整的"序列计划 (Todo List)"。

Todo List 必须清晰展示非线性的章节顺序和 [待处理] 状态。

阶段 4: "计划确认" 检查点 (Checkpoint，关键)

$$核心交互$$

 在 Todo List UI 出现后，Writer Agent Loop (执行) 不会自动开始。

前端必须提供三个选项:

$$按钮$$

 [确认]: 用户对计划满意，点击后触发 阶段 5 (执行)。

$$按钮$$

 [取消]: 用户放弃生成，触发 阶段 6 (中断)。

$$输入框$$

 (保持激活): 用户什么也不点，直接在（仍然是 Plan Agent 状态的）主输入框中输入新的 Query。（触发 阶段 6）

阶段 5: 执行阶段 (Writer Agent Loop)

$$如果用户"确认"$$

$$交互规范 5.1$$

 状态更新 (UI):

Todo List UI 模块中，第一个 Todo 项的状态变为 [进行中]。

$$交互规范 5.2 (关键顺序)$$

 Writer Agent 思考 (流式, 先执行):

前端展示 (对话区): Writer Agent 的 ReAct Thought 实际内容被流式输出（注意：不展示 RAG 检索到的内容本身）。

(Mockup 示例):

```
📋 收到任务：编写"二、研究内容和目标"
🎯 任务目标：明确研究的核心问题和预期目标...

📚 Step 1 - 信息收集：
正在 RAG 检索知识库...
✓ 检索到 5 条相关文档
✓ 提取关键信息点 12 个

🤔 Step 2 - 内容判断：
分析已有信息的完整性...
→ 背景信息：充足 ✓
→ 核心论点：充足 ✓
→ 技术细节：需要补充，再次检索...

🔍 Step 3 - 二次检索：
关键词：["增量更新机制", "性能指标"]
✓ 补充信息已获取

✅ 信息判断完成：信息已充足

✍️ Step 4 - 调用 Editor tool：
开始写入文档...
```

思考完成后，标题变为"Writer Agent 思考过程"，容器折叠。

$$交互规范 5.3 (在 5.2 之后)$$

 "正在编写" 状态卡片:

时机: Writer Agent 思考流结束、确认信息充足、调用 Editor tool 后

前端展示 (对话区): 追加一个新的可点击状态卡片：

```
⚙️ 正在编写：二、研究内容和目标
点击可查看文档区实时输出
```

交互要求: 此卡片可点击。如果"主文档区"关闭，点击它会自动展开并聚焦到文档区。

$$交互规范 5.4$$

 Editor Tool 写入 (流式):

前端展示 (文档区): "章节正文"在主文档区域流式输出（打字机效果，Demo 中模拟）。

$$交互规范 5.5$$

 章节完成 Brief 摘要:

时机: "章节正文"流式输出完毕

前端展示 (UI):
- Todo List UI 模块中，该项状态变为 [已完成]（打勾）
- 对话区追加 Brief 摘要卡片（绿色）：

```
✅ 完成：二、研究内容和目标

阐明了图驱动记忆管理的核心痛点，并确立了包括双图结构设计、增量更新机制和联想检索算法在内的三个主要研究目标。
```

$$交互规范 5.6$$

 中断点 - Writer Agent 暂停 (异常情况):

前端展示: 
- Writer Agent RAG 失败，Todo List 中该项变为 [已暂停]
- 对话区弹出非阻塞式反馈请求：

```
❌ 研究方案 缺少关键信息

[A. 强行继续 (AI 脑补)]  [B. 终止 (待您补充资料)]
```

阶段 6: 中断/重规划 (Plan Agent，待实现 P1)

$$场景 6.1$$

 用户在阶段 4 点击 [取消]:

前端展示:
- "序列计划" UI 面板关闭
- Agent 状态切回 Main Agent（输入框恢复正常）
- Pipeline 终止
- 对话区显示："❌ 已取消生成计划"

$$场景 6.2$$

 用户在阶段 4 输入新 Query:

前端展示:
- Plan Agent 保持激活状态
- 接收用户新 Query，重新运行"计划"
- "序列计划" UI 模块动态更新以反映新的计划
- 系统返回到阶段 4，等待用户对新计划确认

$$场景 6.3 (待实现)$$

 用户在阶段 5 执行期间"外部干预":

用户在"执行阶段"的任何时候，主对话框的输入框保持可用。

Demo 流程示例:

用户输入："等一下，第二章的质量不行，帮我重写"

前端展示:
- Todo List 模块中，新 Todo 项"重写第二章"被动态插入
- 插入位置：[进行中] 任务的下方（最高优先级）
- 当前任务继续完成后，立即执行新插入的任务

阶段 7: 异步交互 (已实现)

$$交互规范 7.1$$

 知识库化进度：

前端展示: 当用户上传文件时（触发 cag 短期记忆），显示进度动画：
- 文件上传进度条
- 处理阶段状态（上传 → 解析 → 拆解 → 提取 → 保存）
- 完成后显示成功消息